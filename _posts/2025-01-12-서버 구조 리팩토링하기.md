---
title: 서버 구조 리팩토링 하기
date: 2025-01-12 00:00:00 +/- TTTT
categories: [project, 탐식당]
tags: [공부 정리, 아키텍처]	# TAG는 반드시 소문자로 이루어져야함!
---
<style>
  figcaption {
    font-size: 14px;
    color: #555;
    font-style: italic;
  }
</style>


## 서론
이번년도부터 본격적으로 취준에 들어가기 위해서 포트폴리오를 정리를 하면서 현재 서버 클래스 간 종속성을 클래스 다이어그램을 그리면서 파악해봤다.

<figure>
    <img src="/assets/img/2025-01-12/img1.png" width="50%" alt="의존성 구조">
    <figcaption>현재 클래스 의존성</figcaption>
</figure>

개발 당시에는 데드라인까지 시간이 여유롭지 않았기 때문에 구조까지 디테일하게 신경쓰기 어려웠기 때문에 복잡도를 포기하고 빠른 개발 생산성을 택했었다. 나름대로 깔끔한 구조를 위해서 도메인별 패키지를 나누어서 작업했지만 도메인 간 경계없이 서로 다른 도메인에 대해서 자유롭게 참조하고 있기 때문에 도메인이 다른 객체끼리도 높은 결합도를 가지게 됐다.

누군가는 "뭐 이런 작은 프로젝트에 의존성까지 신경써?"라는 생각을 할 수도 있을 것 같다. 하지만 언젠가 대규모 프로젝트에서 개발을 한다면 서로 의존성이 엉켜있는 구조를 다시 좋은 구조로 리팩토링할 줄도 알아야 한다고 생각한다. 정말 이상적인 구조로 개선시키려면 헥사고날 아키텍처를 생각해볼 수도 있지만 아무래도 외부와의 연결이 그렇게 많은 프로젝트는 아니기에 계층형 구조를 유지하면서 의존성을 줄이기로 했다.

먼저 UseCase Diagram을 작성하면서 어떤 기능이 필요한지 더 명확히 알아보고 더 나은 구조를 만들기 위해 어떤 부분을 바꿀 수 있을지 생각해보자

<figure>
    <img src="/assets/img/2025-01-12/img2.png" width="50%" alt="UserCase Diagram">
    <figcaption>UseCase Diagram</figcaption>
</figure>


## 도메인간의 관계를 고려하기

UseCase를 보다보니 문득 그런 생각이 들었다.   
메뉴를 조회하거나 식단을 조회하는 경우 특정 식당과 관련된 정보를 원하는데 메뉴에서 식당 혹은 식당에서 식당의 의존성은 존재할 필요가 없을 것으로 보인다.   

메뉴에서 식당에 관한 의존성을 갖고 있는데 어떤 경우인걸까? 
MenuController -> CafeteriaQueryService   
MenuCommandService -> CafeteriaQueryService   
MenuQueryService -> CafeteriaRepository   
위 세 경우를 하나씩 알아보자

<figure>
    <img src="/assets/img/2025-01-12/img3.png" width="100%" alt="MenuController">
    <figcaption>MenuController -> CafeteriaQueryService</figcaption>
</figure>

식당 식별자를 받아서 메뉴를 조회하는 API이다. 이 API는 Cafeteria의 컨트롤러도 빼도 될 것 같다.


<figure>
    <img src="/assets/img/2025-01-12/img4.png" width="100%" alt="MenuQueryService">
    <figcaption>MenuQueryService -> CafeteriaRepository</figcaption>
</figure>

메뉴를 조회하는 클래스에서 왜 cafeteria와 관련된 메서드들이 있던 걸까..? 일단 이 메서드들을 Cafeteria도메인으로 옮겨주고 MenuService 인터페이스도 변경해주자




이전에 진행했던 '탐식당' 프로젝트를 
## 현재 구조 
